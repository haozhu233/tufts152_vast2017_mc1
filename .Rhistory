`car-type`,
c(1:2, "2P", 3:6),
c(
"2 axle cars",
'2 axle truck',
'2 axle truck (P)',
'3 axle truck',
'4+ axle truck',
'2 axle bus',
'3 axle bus'
))) %>%
group_by(gate_type, `car-type`, hr) %>%
count() %>%
ggplot(aes(x = `car-type`, y = n, fill = `car-type`)) +
geom_bar(stat = 'identity') +
facet_wrap(~gate_type) +
coord_flip() +
scale_fill_viridis_d() +
labs(x = "Time of Day", y = "Count of Visit", fill = "Gate ID") +
# scale_y_continuous(breaks = c(0, 2000, 4000, 6000)) +
theme_ipsum(grid = "XY")
ggsave("hist_cartype_gate_type.png")
dt %>%
mutate(`car-type` = factor(
`car-type`,
c(1:2, "2P", 3:6),
c(
"2 axle cars",
'2 axle truck',
'2 axle truck (P)',
'3 axle truck',
'4+ axle truck',
'2 axle bus',
'3 axle bus'
))) %>%
group_by(gate_type, `car-type`, hr) %>%
count() %>%
ggplot(aes(x = `car-type`, y = n, fill = `car-type`)) +
geom_bar(stat = 'identity') +
facet_wrap(~gate_type) +
coord_flip() +
scale_fill_viridis_d() +
labs(x = "Car Types", y = "Count of Visit", fill = "Car Types") +
# scale_y_continuous(breaks = c(0, 2000, 4000, 6000)) +
theme_ipsum(grid = "XY")
ggsave("hist_cartype_gate_type.png")
dt %>%
group_by(gate_type, gate_id, hr) %>%
count() %>%
ggplot(aes(x = hr, y = n, fill = gate_id)) +
geom_bar(stat = 'identity', position = 'stack') +
facet_wrap(~gate_type) +
scale_fill_viridis_d() +
labs(x = "Time of Day", y = "Count of Visits", fill = "Gate ID") +
scale_y_continuous(breaks = c(0, 2000, 4000, 6000)) +
theme_ipsum(grid = "XY")
ggsave("gate_type_time_of_day.png")
dt %>%
mutate(month = str_remove(date, '-..$')) %>%
group_by(gate_type, gate_id, month) %>%
count() %>%
ggplot(aes(x = month, y = n, fill = gate_id)) +
geom_histogram(stat = 'identity', position = 'stack') +
facet_wrap(~gate_type) +
scale_fill_viridis_d() +
scale_x_discrete(breaks = c('2015-05', '2015-11', '2016-05'))+
labs(x = "Time of Year", y = "Count of Visits", fill = "Gate ID") +
theme_ipsum(grid = "XY")
ggsave("gate_type_time_of_year.png")
dt %>%
mutate(`car-type` = factor(
`car-type`,
c(1:2, "2P", 3:6),
c(
"2 axle cars",
'2 axle truck',
'2 axle truck (P)',
'3 axle truck',
'4+ axle truck',
'2 axle bus',
'3 axle bus'
))) %>%
group_by(gate_type, `car-type`, hr) %>%
count() %>%
ggplot(aes(x = `car-type`, y = n, fill = `car-type`)) +
geom_bar(stat = 'identity') +
facet_wrap(~gate_type) +
coord_flip() +
scale_fill_viridis_d() +
labs(x = "Car Types", y = "Count of Visits", fill = "Car Types") +
# scale_y_continuous(breaks = c(0, 2000, 4000, 6000)) +
theme_ipsum(grid = "XY")
ggsave("hist_cartype_gate_type.png")
dt %>%
group_by(gate_type, gate_id) %>% count()
dt %>% group_by(gate_type) %>% summarise(n = length(unique(gate_id)))
write_csv(dt, "processed_data.csv")
library(tidyverse)
library(hrbrthemes)
library(Cairo)
library(extrafont)
extrafont::loadfonts()
dt = read_csv("processed_data.csv")
dt %>%
mutate(`car-type` = factor(
`car-type`,
c(1:2, "2P", 3:6),
c(
"2 axle cars",
'2 axle truck',
'2 axle truck (P)',
'3 axle truck',
'4+ axle truck',
'2 axle bus',
'3 axle bus'
))) %>%
group_by(gate_type, `car-type`, hr) %>%
count() %>%
ggplot(aes(x = `car-type`, y = n, fill = `car-type`)) +
geom_bar(stat = 'identity') +
facet_wrap(~gate_type) +
coord_flip() +
scale_fill_viridis_d() +
labs(x = "Car Types", y = "Count of Visits", fill = "Car Types") +
# scale_y_continuous(breaks = c(0, 2000, 4000, 6000)) +
theme_ipsum(grid = "XY")
dt %>%
mutate(month = str_remove(date, '-..$')) %>%
group_by(gate_type, gate_id, month) %>%
count() %>%
ggplot(aes(x = month, y = n, fill = gate_id)) +
geom_histogram(stat = 'identity', position = 'stack') +
facet_wrap(~gate_type) +
scale_fill_viridis_d() +
scale_x_discrete(breaks = c('2015-05', '2015-11', '2016-05'))+
labs(x = "Time of Year", y = "Count of Visits", fill = "Gate ID") +
theme_ipsum(grid = "XY")
dt %>%
mutate(month = str_remove(date, '-..$')) %>%
group_by(gate_type, gate_id, month) %>%
count() %>%
ggplot(aes(x = month, y = n, fill = gate_id)) +
geom_histogram(stat = 'identity', position = 'stack') +
facet_wrap(~gate_type) +
scale_fill_viridis() +
scale_x_discrete(breaks = c('2015-05', '2015-11', '2016-05'))+
labs(x = "Time of Year", y = "Count of Visits", fill = "Gate ID") +
theme_ipsum(grid = "XY")
library(tidyverse)
library(hrbrthemes)
library(Cairo)
library(extrafont)
extrafont::loadfonts()
dt = read_csv("processed_data.csv") %>%
mutate(gate_id = as.character(gate_id))
dt %>%
mutate(`car-type` = factor(
`car-type`,
c(1:2, "2P", 3:6),
c(
"2 axle cars",
'2 axle truck',
'2 axle truck (P)',
'3 axle truck',
'4+ axle truck',
'2 axle bus',
'3 axle bus'
))) %>%
group_by(gate_type, `car-type`, hr) %>%
count() %>%
ggplot(aes(x = `car-type`, y = n, fill = `car-type`)) +
geom_bar(stat = 'identity') +
facet_wrap(~gate_type) +
coord_flip() +
scale_fill_viridis_d() +
labs(x = "Car Types", y = "Count of Visits", fill = "Car Types") +
# scale_y_continuous(breaks = c(0, 2000, 4000, 6000)) +
theme_ipsum(grid = "XY")
dt %>%
mutate(month = str_remove(date, '-..$')) %>%
group_by(gate_type, gate_id, month) %>%
count() %>%
ggplot(aes(x = month, y = n, fill = gate_id)) +
geom_histogram(stat = 'identity', position = 'stack') +
facet_wrap(~gate_type) +
scale_fill_viridis() +
scale_x_discrete(breaks = c('2015-05', '2015-11', '2016-05'))+
labs(x = "Time of Year", y = "Count of Visits", fill = "Gate ID") +
theme_ipsum(grid = "XY")
dt %>%
mutate(month = str_remove(date, '-..$')) %>%
group_by(gate_type, gate_id, month) %>%
count() %>%
ggplot(aes(x = month, y = n, fill = gate_id)) +
geom_histogram(stat = 'identity', position = 'stack') +
facet_wrap(~gate_type) +
scale_fill_viridis_d() +
scale_x_discrete(breaks = c('2015-05', '2015-11', '2016-05'))+
labs(x = "Time of Year", y = "Count of Visits", fill = "Gate ID") +
theme_ipsum(grid = "XY")
library(rvest)
library(xml2)
pages = lapply(paste0("https://anaconda.org/pytorch/pytorch/files?page=", 1:10),
xml2::read_html)
pages[[1]]
xml_child(pages[[1]], 2)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
pages[[1]] %>%
xml_child(2) %>%
xml_child(2)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
ra
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(1)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(1) %>%
a
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(1) %>%
xml_child(9)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(1) %>%
xml_child(9) %>%
xml_child(1)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(1) %>%
xml_child(9) %>%
xml_child(1) %>%
xml_child(1)
pages[[1]] %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(1) %>%
xml_child(9) %>%
xml_child(1) %>%
xml_child(1) %>%
xml_child(4) %>%
html_table()
tables = lapply(pages, function(x) {
x %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(2) %>%
xml_child(1) %>%
xml_child(9) %>%
xml_child(1) %>%
xml_child(1) %>%
xml_child(4) %>%
html_table()
})
library(tidyverse)
tables = bind_rows(tables)
View(tables)
tables$Name
dt = tables %>%
mutate(Name = str_remove(Name, '|\n              \n              ', ''))
dt = tables %>%
mutate(Name = str_remove(Name, '|\\n              \\n              ', ''))
dt = tables %>%
mutate(Name = sub('|\\n              \\n              ', '', Name))
View(dt)
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name))
View(dt)
dt$Name
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\.tar\\.bz2$', '', Name))
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\_0\\.tar\\.bz2$', '', Name))
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\_0\\.tar\\.bz2$', '', Name)) %>%
separate(Name, c('sys', 'ver'), sep = '/')
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\_0\\.tar\\.bz2$', '', Name)) %>%
separate(Name, c('sys', 'ver'), sep = '/') %>%
separate(ver, c('trash', 'ver', 'env')) %>%
select(-trash)
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\_0\\.tar\\.bz2$', '', Name)) %>%
separate(Name, c('sys', 'ver'), sep = '/') %>%
separate(ver, c('trash', 'ver', 'env'), sep = '-') %>%
select(-trash)
substr(dt$Size[1], -2, -1)
substr(dt$Size[1], -3, -1)
substr(dt$Size[1], 1, 2)
substr(dt$Size[1], length(dt$Size[1]) - 2, length(dt$Size[1]))
substr(dt$Size[1], nchar(dt$Size[1]) - 2, nchar(dt$Size[1]))
substr(dt$Size[1], nchar(dt$Size[1]) - 1, nchar(dt$Size[1]))
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\_0\\.tar\\.bz2$', '', Name)) %>%
separate(Name, c('sys', 'ver'), sep = '/') %>%
separate(ver, c('trash', 'ver', 'env'), sep = '-') %>%
separate(Size, c('size', 'size_unit'), sep = ' ') %>%
mutate(size = ifelse(size_unit == "MB", size / 1024, size)) %>%
select(-trash)
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\_0\\.tar\\.bz2$', '', Name)) %>%
separate(Name, c('sys', 'ver'), sep = '/') %>%
separate(ver, c('trash', 'ver', 'env'), sep = '-') %>%
separate(Size, c('size', 'size_unit'), sep = ' ')
dt = tables %>%
mutate(Name = sub('\\|\\n              \\n              ', '', Name),
Name = sub('\\_0\\.tar\\.bz2$', '', Name)) %>%
separate(Name, c('sys', 'ver'), sep = '/') %>%
separate(ver, c('trash', 'ver', 'env'), sep = '-') %>%
separate(Size, c('size', 'size_unit'), sep = ' ') %>%
mutate(
size = as.numeric(size),
size = ifelse(size_unit == "MB", size / 1024, size)) %>%
select(-trash)
ggplot(dt, aes(x = ver, y = size))+
geom_point()
ggplot(dt, aes(x = ver, y = size, color = sys))+
geom_point()
View(dt)
dt = read_csv("processed_data.csv") %>%
mutate(gate_id = as.character(gate_id))
View(dt)
unique(dt$`gate-name`)
aaa = data.frame(gates = unique(dt$`gate-name`), x = 0, y = 0) %>% arrange(gates)
write_csv(aaa, "gate_loc.csv")
library(tidyverse)
dt = read_csv("processed_data.csv")
dt
dt %>%
filter(gate_type == "entrance")
dt = read_csv("Lekagul Sensor Data.csv")
dt
View(dt)
dt %>%
filter(`car-id` == '20154301124328-262') %>%
View()
dt %>%
filter(`car-id` == '20153101013141-937') %>%
View()
dt %>%
separate(Timestamp, c('date', 'time'))
dt %>%
separate(Timestamp, c('date', 'time'), sep = ' ')
dt = read_csv("Lekagul Sensor Data.csv")
library(lubridate)
dt %>%
mutate(Timestamp = lubridate::as_datetime(Timestamp))
dt2 = dt %>%
mutate(
Timestamp = lubridate::as_datetime(Timestamp),
date = lubridate::as_date(Timestamp)
)
View(dt2)
day(dt2$Timestamp)
lubridate::wday(dt2$Timestamp[0])
lubridate::wday(dt2$Timestamp[100])
lubridate::wday(dt2$Timestamp)
dt2 = dt %>%
mutate(
Timestamp = lubridate::as_datetime(Timestamp),
date = lubridate::as_date(Timestamp),
hr = lubridate::hour(Timestamp),
weekday = lubridate::wday(Timestamp)
)
View(dt2)
dt = dt %>%
mutate(
Timestamp = lubridate::as_datetime(Timestamp),
date = lubridate::as_date(Timestamp),
hr = lubridate::hour(Timestamp),
weekday = lubridate::wday(Timestamp)
)
dt %>%
group_by(`car-id`, date) %>%
count()
dt %>%
group_by(`car-id`) %>%
summarise(
n_days = len(unique(date))
)
dt %>%
group_by(`car-id`) %>%
summarise(
n_days = length(unique(date))
)
dt %>%
group_by(`car-id`) %>%
summarise(
n_days = length(unique(date))
) %>%
arrange(n_days)
dt %>%
group_by(`car-id`) %>%
summarise(
n_days = length(unique(date))
) %>%
arrange(desc(n_days))
dt %>% filter(`car-id` == '20154519024544-322')
dt %>% filter(`car-id` == '20154519024544-322') %>% View()
unique(dt$`gate-name`)
dt = dt %>%
mutate(
Timestamp = lubridate::as_datetime(Timestamp),
date = lubridate::as_date(Timestamp),
hr = lubridate::hour(Timestamp),
weekday = lubridate::wday(Timestamp),
gate_type = stringr::str_remove(`gate-name`, '[0-9]$')
)
View(dt)
nested_dt = dt %>%
group_by(`car-id`) %>%
nested()
nested_dt = dt %>%
group_by(`car-id`) %>%
nest()
View(nested_dt)
View(nested_dt[[2]][[1]])
View(nested_dt[[2]][[12]])
separate_visit = function(gate_types) {
out = integer(length(gate_types))
visit_num = 0
seen = 0
for (i in seq(length(gate_types))) {
out[i] = visit_num
if (gate_types[i] == "entrance") {
if (seen == 0) {
seen = 1
} else {
seen = 0
visit_num = visit_num + 1
}
}
}
return(out)
}
View(nested_dt[[2]][[10]])
View(nested_dt[[2]][[6]])
View(nested_dt[[2]][[185]])
View(nested_dt[[2]][[250]])
View(nested_dt[[2]][[308]])
View(nested_dt[[2]][[304]])
View(nested_dt[[2]][[296]])
nested_dt %>% mutate(data = map_int(data, ~nrow(.x)))
nested_dt %>% mutate(data = map_int(data, ~nrow(.x))) %>% arrange(desc(data))
nest_dt %>% filter(`car-id` == '20154112014114-381')
nested_dt %>% filter(`car-id` == '20154112014114-381')
nested_dt %>% filter(`car-id` == '20154112014114-381') %>% View()
View(.[[2]][[1]])
View(.[[2]][[1]])
separate_visit((nested_dt %>% filter(`car-id` == '20154112014114-381'))$gate_type)
(nested_dt %>% filter(`car-id` == '20154112014114-381'))$gate_type
(nested_dt %>% filter(`car-id` == '20154112014114-381'))
(nested_dt %>% filter(`car-id` == '20154112014114-381'))$data$gate_type
(nested_dt %>% filter(`car-id` == '20154112014114-381'))$data
(nested_dt %>% filter(`car-id` == '20154112014114-381'))$data[[1]]$gate_type
separate_visit((nested_dt %>% filter(`car-id` == '20154112014114-381'))$data[[1]]$gate_type)
(nested_dt %>% filter(`car-id` == '20154112014114-381'))$data[[1]]
(nested_dt %>% filter(`car-id` == '20154112014114-381'))$data[[1]] %>% View()
nested_dt = nested_dt %>%
mutate(data = map(data, ~ .x$visit = separate_visit(.x$gate_type)))
})
nested_dt = nested_dt %>%
mutate(data = map(data, function(x) {
x$visit = separate_visit(x$gate_type)
return(x)
}))
View(nested_dt)
View(nested_dt[[2]][[1]])
dt2 = unnest(nested_dt)
dt2 = unnest(nested_dt, cols = c(data))
View(dt2)
nested_dt = nested_dt %>%
mutate(data = map(data, function(x) {
x$visit = separate_visit(x$gate_type)
x$total_visit_count = max(x$visit) + 1
return(x)
}))
dt2 = unnest(nested_dt, cols = c(data))
View(dt2)
dt2 %>%
arrange(desc(total_visit_count))
